<div class="container mt-5" style="max-width: 600px;">
  <!-- テキスト情報 -->
  <div class="text-center mb-4">
    <!-- 教材カバー画像 -->
    <%= image_tag @audio.chapter.textbook.cover_image, alt: @audio.chapter.textbook.name,
                  class: "rounded mb-3", style: "width:200px; height:200px; object-fit:cover;" %>
    
    <!-- 教材名 -->
    <h5 class="text-muted mb-1"><%= @audio.chapter.textbook.name %></h5>

    <!-- 音声タイトル -->
    <h3 class="fw-bold"><%= @audio.title %></h3>
  </div>

  <!-- ポッドキャスト風プレイヤー -->
  <div class="card shadow-sm p-3">
    <audio id="player" controls style="width: 100%;">
    <source src="<%= url_for(@audio.file) %>" type="audio/mpeg">
    お使いのブラウザはaudioタグをサポートしていません。
    </audio>

    <!-- 操作ボタン -->
    <div class="mt-3 d-flex align-items-center gap-2 flex-wrap justify-content-center">
      <button class="btn btn-outline-secondary btn-sm" onclick="skip(-3)">« 3秒戻る</button>
      <button class="btn btn-outline-secondary btn-sm" onclick="skip(3)">3秒進む »</button>

      <label class="d-flex align-items-center gap-1 mb-0">
        速度:
        <select id="speed" onchange="changeSpeed()">
          <option value="0.7">0.7x</option>
          <option value="0.8">0.8x</option>
          <option value="0.9">0.9x</option>
          <option value="1" selected>1x</option>
          <option value="1.1">1.1x</option>
          <option value="1.2">1.2x</option>
          <option value="1.3">1.3x</option>
          <option value="1.4">1.4x</option>
          <option value="1.5">1.5x</option>
          <option value="1.6">1.6x</option>
          <option value="1.7">1.7x</option>
        </select>
      </label>

      <button class="btn btn-outline-secondary btn-sm" onclick="toggleLoop()">リピート切替</button>
    </div>
  </div>
</div>

<script>
  const player = document.getElementById("player");

  function skip(seconds) { player.currentTime += seconds; }
  function changeSpeed() { player.playbackRate = parseFloat(document.getElementById("speed").value); }
  function toggleLoop() { 
    player.loop = !player.loop; 
    alert(player.loop ? "リピートON" : "リピートOFF"); 
  }
</script>
